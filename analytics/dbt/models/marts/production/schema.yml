version: 2

models:
  - name: marts_production_housing
    description: "Table principale des logements avec informations compl√®tes incluant les derniers statuts, territoires sp√©ciaux et m√©triques de campagnes"
    columns:
      - name: housing_id
        description: "Identifiant unique du logement (UUID converti en VARCHAR)"
        tests:
          - unique
          - not_null
      - name: id
        description: "Identifiant UUID original du logement"
        tests:
          - unique
          - not_null
      - name: invariant
        description: "Identifiant invariant du logement dans les fichiers fonciers"
      - name: local_id
        description: "Identifiant local du logement"
      - name: building_id
        description: "Identifiant du b√¢timent auquel appartient le logement"
      - name: address_dgfip
        description: "Adresse du logement selon la DGFiP (format array)"
      - name: geo_code
        description: "Code g√©ographique INSEE de la commune"
      - name: longitude_dgfip
        description: "Longitude du logement selon la DGFiP"
      - name: latitude_dgfip
        description: "Latitude du logement selon la DGFiP"
      - name: cadastral_classification
        description: "Classification cadastrale du logement"
      - name: uncomfortable
        description: "Indicateur si le logement est inconfortable (boolean)"
      - name: vacancy_start_year
        description: "Ann√©e de d√©but de vacance du logement"
      - name: housing_kind
        description: "Type de logement (maison, appartement, etc.)"
      - name: rooms_count
        description: "Nombre de pi√®ces du logement"
      - name: living_area
        description: "Surface habitable du logement en m¬≤"
      - name: cadastral_reference
        description: "R√©f√©rence cadastrale du logement"
      - name: building_year
        description: "Ann√©e de construction du b√¢timent"
      - name: mutation_date
        description: "Date de la derni√®re mutation"
      - name: taxed
        description: "Indicateur si le logement est tax√© (boolean)"
      - name: data_years
        description: "Ann√©es de donn√©es disponibles pour ce logement (array)"
      - name: beneficiary_count
        description: "Nombre de b√©n√©ficiaires"
      - name: building_location
        description: "Localisation du b√¢timent"
      - name: rental_value
        description: "Valeur locative du logement"
      - name: condominium
        description: "Information sur la copropri√©t√©"
      - name: status
        description: "Statut du logement"
      - name: sub_status
        description: "Sous-statut du logement"
      - name: energy_consumption_bdnb
        description: "Classe de consommation √©nerg√©tique selon la BDNB"
      - name: occupancy_source
        description: "Source de l'information d'occupation"
      - name: occupancy
        description: "Statut d'occupation du logement (V=Vacant, P=Occup√© par le propri√©taire, L=En location, etc.)"
      - name: occupancy_intended
        description: "Occupation pr√©vue du logement"
      - name: plot_id
        description: "Identifiant de la parcelle"
      - name: energy_consumption_at_bdnb
        description: "Date de mise √† jour de la consommation √©nerg√©tique BDNB"
      - name: building_group_id
        description: "Identifiant du groupe de b√¢timents"
      - name: data_source
        description: "Source des donn√©es du logement"
      - name: data_file_years
        description: "Ann√©es des fichiers de donn√©es (format array)"
      - name: geolocation
        description: "G√©olocalisation du logement"
      - name: plot_area
        description: "Surface de la parcelle en m¬≤"
      - name: last_mutation_date
        description: "Date de la derni√®re mutation (timestamp)"
      - name: last_transaction_date
        description: "Date de la derni√®re transaction"
      - name: last_transaction_value
        description: "Valeur de la derni√®re transaction"
      - name: occupancy_history
        description: "Historique des occupations"
      - name: last_mutation_type
        description: "Type de la derni√®re mutation"
      - name: city_code
        description: "Code INSEE de la commune"
      - name: energy_sieve
        description: "Indicateur passoire √©nerg√©tique (F ou G) - calcul√©"
        data_tests:
          - accepted_values:
              values: [true, false]
      - name: vacant_two_years
        description: "Indicateur logement vacant depuis plus de 2 ans - calcul√©"
        data_tests:
          - accepted_values:
              values: [true, false]
      - name: is_in_opah_teritory
        description: "Indicateur si le logement est en territoire OPAH"
      - name: is_in_tlv1_teritory
        description: "Indicateur si le logement est en territoire TLV1"
      - name: is_in_tlv2_teritory
        description: "Indicateur si le logement est en territoire TLV2"
      - name: is_in_action_coeur_de_ville_teritory
        description: "Indicateur si le logement est en territoire Action C≈ìur de Ville"
      - name: is_in_petite_ville_de_demain_teritory
        description: "Indicateur si le logement est en territoire Petite Ville de Demain"
      - name: is_in_village_davenir_teritory
        description: "Indicateur si le logement est en territoire Village d'Avenir"
      - name: label
        description: "Label du territoire"
      - name: total_validated
        description: "Nombre total de campagnes valid√©es pour ce logement"
      - name: total_confirmed
        description: "Nombre total de campagnes confirm√©es pour ce logement"
      - name: total_sent
        description: "Nombre total de campagnes envoy√©es pour ce logement"
      - name: total_groups
        description: "Nombre total de groupes auxquels appartient le logement"
      - name: establishment_ids
        description: "Identifiants des √©tablissements li√©s (format string)"
      - name: establishment_ids_array
        description: "Identifiants des √©tablissements li√©s (format array UUID)"
      - name: is_on_user_teritory
        description: "Indicateur si le logement est sur un territoire utilisateur"

  - name: marts_production_campaigns
    description: "Table des campagnes de communication avec m√©triques de performance et statistiques de retour"
    columns:
      - name: campaign_id
        description: "Identifiant unique de la campagne (UUID converti en VARCHAR)"
        tests:
          - unique
          - not_null
      - name: id
        description: "Identifiant UUID original de la campagne"
        tests:
          - unique
          - not_null
      - name: campaign_number_deprecated
        description: "Num√©ro de campagne (d√©pr√©ci√©)"
      - name: start_month_deprecated
        description: "Mois de d√©but (d√©pr√©ci√©)"
      - name: reminder_number_deprecated
        description: "Num√©ro de relance (d√©pr√©ci√©)"
      - name: filters
        description: "Filtres appliqu√©s √† la campagne (format JSON)"
      - name: created_at
        description: "Date de cr√©ation de la campagne"
        tests:
          - not_null
      - name: validated_at
        description: "Date de validation de la campagne"
      - name: exported_at
        description: "Date d'export de la campagne"
      - name: sent_at
        description: "Date d'envoi de la campagne"
      - name: establishment_id
        description: "Identifiant de l'√©tablissement propri√©taire de la campagne"
        tests:
          - not_null
          - relationships:
              to: ref('marts_production_establishments')
              field: id
      - name: user_id
        description: "Identifiant de l'utilisateur cr√©ateur de la campagne"
      - name: recovery_id
        description: "Identifiant de r√©cup√©ration"
      - name: kind_deprecated
        description: "Type de campagne (d√©pr√©ci√©)"
      - name: title
        description: "Titre de la campagne"
        tests:
          - not_null
      - name: archived_at
        description: "Date d'archivage de la campagne"
      - name: confirmed_at
        description: "Date de confirmation de la campagne"
      - name: group_id
        description: "Identifiant du groupe associ√© √† la campagne"
        tests:
          - relationships:
              to: ref('marts_production_groups')
              field: id
      - name: status
        description: "Statut de la campagne (draft, in-progress, sent, archived)"
      - name: file
        description: "Fichier associ√© √† la campagne"
      - name: description
        description: "Description de la campagne"
      - name: is_validated
        description: "Indicateur si la campagne est valid√©e (0/1)"
        data_tests:
          - accepted_values:
              values: [0, 1]
      - name: is_confirmed
        description: "Indicateur si la campagne est confirm√©e (0/1)"
        data_tests:
          - accepted_values:
              values: [0, 1]
      - name: is_sent
        description: "Indicateur si la campagne est envoy√©e (0/1)"
        data_tests:
          - accepted_values:
              values: [0, 1]
      - name: is_creation_gt_30_days
        description: "Indicateur si la cr√©ation date de plus de 30 jours (0/1)"
      - name: is_creation_lt_30_days
        description: "Indicateur si la cr√©ation date de moins de 30 jours (0/1)"
      - name: next_campaign_sent_at
        description: "Date d'envoi de la prochaine campagne"
      - name: time_to_next_campaign
        description: "Temps jusqu'√† la prochaine campagne (interval)"
      - name: housing_number_in_campaign
        description: "Nombre de logements dans la campagne"
      - name: return_count_3_months
        description: "Nombre de retours dans les 3 mois"
      - name: return_rate_3_months
        description: "Taux de retour dans les 3 mois (%)"
      - name: has_next_campaign_in_3_months
        description: "Indicateur s'il y a une prochaine campagne dans les 3 mois"
      - name: return_count_6_months
        description: "Nombre de retours dans les 6 mois"
      - name: return_rate_6_months
        description: "Taux de retour dans les 6 mois (%)"
      - name: has_next_campaign_in_6_months
        description: "Indicateur s'il y a une prochaine campagne dans les 6 mois"
      - name: return_count_9_months
        description: "Nombre de retours dans les 9 mois"
      - name: return_rate_9_months
        description: "Taux de retour dans les 9 mois (%)"
      - name: has_next_campaign_in_9_months
        description: "Indicateur s'il y a une prochaine campagne dans les 9 mois"
      - name: return_count_36_months
        description: "Nombre de retours dans les 36 mois"
      - name: return_rate_36_months
        description: "Taux de retour dans les 36 mois (%)"
      - name: has_next_campaign_in_36_months
        description: "Indicateur s'il y a une prochaine campagne dans les 36 mois"
      - name: first_event_global_date
        description: "Date du premier √©v√©nement global"
      - name: last_event_global_date
        description: "Date du dernier √©v√©nement global"
      - name: first_event_followup_date
        description: "Date du premier √©v√©nement de suivi"
      - name: last_event_followup_date
        description: "Date du dernier √©v√©nement de suivi"
      - name: first_event_ownership_date
        description: "Date du premier √©v√©nement de propri√©t√©"
      - name: last_event_ownership_date
        description: "Date du dernier √©v√©nement de propri√©t√©"

  - name: marts_production_establishments
    description: "Table principale des √©tablissements avec informations compl√®tes sur les utilisateurs, campagnes, groupes, p√©rim√®tres et contacts"
    columns:
      - name: establishment_id
        description: "Identifiant unique de l'√©tablissement (UUID converti en VARCHAR)"
        tests:
          - unique
          - not_null
      - name: id
        description: "Identifiant UUID original de l'√©tablissement"
        tests:
          - unique
          - not_null
      - name: siren
        description: "Num√©ro SIREN de l'√©tablissement"
      - name: name
        description: "Nom de l'√©tablissement"
        tests:
          - not_null
      - name: available
        description: "Indicateur si l'√©tablissement est disponible"
        tests:
          - not_null
      - name: localities_geo_code
        description: "Codes g√©ographiques des communes couvertes (array)"
      - name: updated_at
        description: "Date de derni√®re mise √† jour"
      - name: source
        description: "Source des donn√©es de l'√©tablissement"
      - name: suspended_at
        description: "Date de suspension de l'√©tablissement"
      - name: suspended_cause
        description: "Cause de la suspension"
      - name: deleted_at
        description: "Date de suppression de l'√©tablissement"
      - name: establishment_kind_label
        description: "Libell√© du type d'√©tablissement"
      - name: establishment_synthetic_type_label
        description: "Libell√© synth√©tique du type d'√©tablissement"
      - name: covered_by_state_service
        description: "Indicateur si couvert par un service de l'√âtat"
      - name: user_ids
        description: "Identifiants des utilisateurs (format string s√©par√© par virgules)"
      - name: user_emails
        description: "Emails des utilisateurs (format string s√©par√© par virgules)"
      - name: user_number
        description: "Nombre d'utilisateurs de l'√©tablissement"
      - name: is_active
        description: "Indicateur si l'√©tablissement est actif"
      - name: last_activated_at
        description: "Date de derni√®re activation"
      - name: first_activated_at
        description: "Date de premi√®re activation"
      - name: last_authenticated_at
        description: "Date de derni√®re authentification"
      - name: connected_last_30_days
        description: "Indicateur de connexion dans les 30 derniers jours"
      - name: connected_last_60_days
        description: "Indicateur de connexion dans les 60 derniers jours"
      - name: connected_last_90_days
        description: "Indicateur de connexion dans les 90 derniers jours"
      - name: has_campaigns
        description: "Indicateur si l'√©tablissement a des campagnes"
      - name: total_campaigns
        description: "Nombre total de campagnes"
      - name: total_sent_campaigns
        description: "Nombre total de campagnes envoy√©es"
      - name: total_exported_campaigns
        description: "Nombre total de campagnes export√©es"
      - name: last_campaign_created
        description: "Date de cr√©ation de la derni√®re campagne"
      - name: first_campaign_created
        description: "Date de cr√©ation de la premi√®re campagne"
      - name: has_groups
        description: "Indicateur si l'√©tablissement a des groupes"
      - name: total_groups
        description: "Nombre total de groupes"
      - name: total_exported_groups
        description: "Nombre total de groupes export√©s"
      - name: last_group_created
        description: "Date de cr√©ation du dernier groupe"
      - name: first_group_created
        description: "Date de cr√©ation du premier groupe"
      - name: has_perimeters
        description: "Indicateur si l'√©tablissement a des p√©rim√®tres"
      - name: total_perimeters
        description: "Nombre total de p√©rim√®tres"
      - name: total_shapes
        description: "Nombre total de formes g√©ographiques"
      - name: total_kinds
        description: "Nombre total de types"
      - name: contacted_housing_2020
        description: "Nombre de logements contact√©s en 2020"
      - name: contacted_housing_2021
        description: "Nombre de logements contact√©s en 2021"
      - name: contacted_housing_2022
        description: "Nombre de logements contact√©s en 2022"
      - name: contacted_housing_2023
        description: "Nombre de logements contact√©s en 2023"
      - name: contacted_housing_2024
        description: "Nombre de logements contact√©s en 2024"
      - name: contacted_housing_2025
        description: "Nombre de logements contact√©s en 2025"
      - name: contacts_number_2020
        description: "Nombre de contacts en 2020"
      - name: contacts_number_2021
        description: "Nombre de contacts en 2021"
      - name: contacts_number_2022
        description: "Nombre de contacts en 2022"
      - name: contacts_number_2023
        description: "Nombre de contacts en 2023"
      - name: contacts_number_2024
        description: "Nombre de contacts en 2024"
      - name: contacts_number_2025
        description: "Nombre de contacts en 2025"
      - name: contacted_housing_followup_ended_2020
        description: "Nombre de logements contact√©s avec suivi termin√© en 2020"
      - name: contacted_housing_followup_ended_2021
        description: "Nombre de logements contact√©s avec suivi termin√© en 2021"
      - name: contacted_housing_followup_ended_2022
        description: "Nombre de logements contact√©s avec suivi termin√© en 2022"
      - name: contacted_housing_followup_ended_2023
        description: "Nombre de logements contact√©s avec suivi termin√© en 2023"
      - name: contacted_housing_followup_ended_2024
        description: "Nombre de logements contact√©s avec suivi termin√© en 2024"
      - name: contacted_housing_followup_ended_2025
        description: "Nombre de logements contact√©s avec suivi termin√© en 2025"
      - name: contacted_housing_followup_ended_not_vacant_2020
        description: "Nombre de logements contact√©s avec suivi termin√© (non vacant) en 2020"
      - name: contacted_housing_followup_ended_not_vacant_2021
        description: "Nombre de logements contact√©s avec suivi termin√© (non vacant) en 2021"
      - name: contacted_housing_followup_ended_not_vacant_2022
        description: "Nombre de logements contact√©s avec suivi termin√© (non vacant) en 2022"
      - name: contacted_housing_followup_ended_not_vacant_2023
        description: "Nombre de logements contact√©s avec suivi termin√© (non vacant) en 2023"
      - name: contacted_housing_followup_ended_not_vacant_2024
        description: "Nombre de logements contact√©s avec suivi termin√© (non vacant) en 2024"
      - name: contacted_housing_followup_ended_not_vacant_2025
        description: "Nombre de logements contact√©s avec suivi termin√© (non vacant) en 2025"
      - name: last_event_status_user_followup
        description: "Statut du dernier √©v√©nement de suivi utilisateur"
      - name: last_event_status_label_user_followup
        description: "Libell√© du statut du dernier √©v√©nement de suivi utilisateur"
      - name: last_event_date_user_followup
        description: "Date du dernier √©v√©nement de suivi utilisateur"
      - name: last_event_sub_status_label_user_followup
        description: "Libell√© du sous-statut du dernier √©v√©nement de suivi utilisateur"
      - name: last_event_occupancy_user_occupancy
        description: "Occupation du dernier √©v√©nement utilisateur"
      - name: last_event_date_user_occupancy
        description: "Date du dernier √©v√©nement d'occupation utilisateur"

  - name: marts_production_establishments_activation
    description: "Analyse de l'activation des √©tablissements avec typologie d√©taill√©e bas√©e sur l'utilisation de la plateforme"
    columns:
      - name: establishment_id
        description: "Identifiant unique de l'√©tablissement"
        tests:
          - unique
          - not_null
          - relationships:
              to: ref('marts_production_establishments')
              field: establishment_id
      - name: connecte_90_derniers_jours
        description: "Connexion dans les 90 derniers jours (Oui/üëª Fant√¥me)"
        data_tests:
          - accepted_values:
              values: ['Oui', 'üëª Fant√¥me']
      - name: connecte_60_derniers_jours
        description: "Connexion dans les 60 derniers jours (Oui/Non)"
        data_tests:
          - accepted_values:
              values: ['Oui', 'Non']
      - name: connecte_30_derniers_jours
        description: "Connexion dans les 30 derniers jours (Oui/Non)"
        data_tests:
          - accepted_values:
              values: ['Oui', 'Non']
      - name: a_depose_1_perimetre
        description: "A d√©pos√© au moins 1 p√©rim√®tre (oui/non)"
        data_tests:
          - accepted_values:
              values: ['oui', 'non']
      - name: a_cree_1_groupe
        description: "A cr√©√© au moins 1 groupe (oui/non)"
        data_tests:
          - accepted_values:
              values: ['oui', 'non']
      - name: a_cree_1_campagne
        description: "A cr√©√© au moins 1 campagne (oui/non)"
        data_tests:
          - accepted_values:
              values: ['oui', 'non']
      - name: a_cree_1_campagne_30_derniers_jours
        description: "A cr√©√© au moins 1 campagne dans les 30 derniers jours (Oui/Non)"
        data_tests:
          - accepted_values:
              values: ['Oui', 'Non']
      - name: a_envoye_1_campagne
        description: "A envoy√© au moins 1 campagne (oui/non)"
        data_tests:
          - accepted_values:
              values: ['oui', 'non']
      - name: a_fait_1_maj_suivi
        description: "A fait au moins 1 mise √† jour de suivi (Oui/Non)"
        data_tests:
          - accepted_values:
              values: ['Oui', 'Non']
      - name: a_fait_1_maj_occupation
        description: "A fait au moins 1 mise √† jour d'occupation (Oui/Non)"
        data_tests:
          - accepted_values:
              values: ['Oui', 'Non']
      - name: a_fait_1_maj
        description: "A fait au moins 1 mise √† jour (suivi ou occupation) (Oui/Non)"
        data_tests:
          - accepted_values:
              values: ['Oui', 'Non']
      - name: a_fait_1_campagne_ET_1_maj
        description: "A fait au moins 1 campagne ET 1 mise √† jour (Oui/Non)"
        data_tests:
          - accepted_values:
              values: ['Oui', 'Non']
      - name: typologie_activation_simple
        description: "Typologie d'activation simplifi√©e (4 niveaux)"
        data_tests:
          - accepted_values:
              values: ['(1) CT inactive', '(2) CT en analyse', '(3) CT en campagne', '(4) CT activ√©e', 'Erreur de classification']
      - name: typologie_activation_detaillee
        description: "Typologie d'activation d√©taill√©e (10 niveaux croisant activation et connexion)"
        data_tests:
          - accepted_values:
              values: ['(1.1) CT inactive et fant√¥me', '(1.2) CT inactive et visiteuse', '(2.1) CT en analyse et fant√¥me', '(2.2) CT en analyse et visiteuse', '(3.1) CT en campagne et fant√¥me', '(3.2) CT en campagne et visiteuse', '(4.1) CT pro-active et fant√¥me', '(4.2) CT pro-active et visiteuse', '(5.1) CT exemplaire et fant√¥me', '(5.2) CT exemplaire et visiteuse', 'Erreur de classification']
      - name: type_explicite
        description: "Type d'√©tablissement explicite (libell√© complet)"
      - name: type_regroupe
        description: "Type d'√©tablissement regroup√© (4 cat√©gories principales)"
        data_tests:
          - accepted_values:
              values: ['Intercommunalit√©', 'Commune', 'DDT/M', 'Autre']

  - name: marts_production_establishments_category_pro_activity
    description: "Classification de pro-activit√© des √©tablissements op√©rationnels ouverts (EPCI, Communes) bas√©e sur diff√©rents crit√®res de performance dans la lutte contre la vacance"
    columns:
      - name: establishment_id
        description: "Identifiant unique de l'√©tablissement"
        tests:
          - unique
          - not_null
          - relationships:
              to: ref('marts_production_establishments')
              field: establishment_id
      - name: name
        description: "Nom de l'√©tablissement"
      - name: kind
        description: "Type d'√©tablissement (CA, CC, CU, ME, Commune)"
        data_tests:
          - accepted_values:
              values: ['CA', 'CC', 'CU', 'ME', 'Commune']
      - name: total_campaigns_sent
        description: "Nombre total de campagnes envoy√©es"
      - name: housing_contacted_2024
        description: "Nombre de logements contact√©s en 2024"
      - name: housing_rate_contacted_2024
        description: "Taux de logements contact√©s en 2024 par rapport au parc total (LOVAC 24 + FF 23)"
      - name: housing_vacant_rate_contacted_2024
        description: "Taux de logements vacants contact√©s en 2024 par rapport au parc vacant LOVAC 24"
      - name: housing_vacant_rate_contacted_2023
        description: "Taux de logements vacants contact√©s en 2023 par rapport au parc vacant LOVAC 23"
      - name: housing_rented_rate_contacted_2024
        description: "Taux de logements locatifs contact√©s en 2024 par rapport au parc locatif FF 23"
      - name: kind_campaigns_sent_quantile
        description: "Classification par quartiles du nombre de campagnes envoy√©es - m√©thode quantile (1-4)"
        data_tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: kind_housing_contacted_quantile
        description: "Classification par quartiles du nombre de logements contact√©s - m√©thode quantile (1-4)"
        data_tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: kind_housing_rate_contacted_2024_quantile
        description: "Classification par quartiles du taux de logements contact√©s en 2024 - m√©thode quantile (1-4)"
        data_tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: kind_housing_vacant_rate_contacted_quantile
        description: "Classification par quartiles du taux de logements vacants contact√©s - m√©thode quantile (1-4)"
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: kind_housing_vacant_rate_contacted_2024_quantile
        description: "Classification par quartiles du taux de logements vacants contact√©s en 2024 - m√©thode quantile (1-4)"
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: kind_housing_vacant_rate_contacted_2023_quantile
        description: "Classification par quartiles du taux de logements vacants contact√©s en 2023 - m√©thode quantile (1-4)"
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: kind_housing_rented_rate_contacted_2024_quantile
        description: "Classification par quartiles du taux de logements locatifs contact√©s en 2024 - m√©thode quantile (1-4)"
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: total_pro_activity_quantile
        description: "Score total de pro-activit√© - m√©thode quantile (somme des 7 crit√®res, de 7 √† 28 points)"
        tests:
          - dbt_utils.accepted_range:
              min_value: 7
              max_value: 28
      - name: kind_pro_activity_quantile
        description: "Classification finale de pro-activit√© par quartiles - m√©thode quantile"
        tests:
          - accepted_values:
              values: ['Non pro-actif', 'Peu pro-actif', 'Pro-actif', 'Tr√®s pro-actif']
      - name: kind_pro_activity_ntile
        description: "Classification finale de pro-activit√© par quartiles - m√©thode ntile"
        tests:
          - accepted_values:
              values: ['Non pro-actif', 'Peu pro-actif', 'Pro-actif', 'Tr√®s pro-actif']

  - name: marts_production_groups
    description: "Table des groupes de logements cr√©√©s par les utilisateurs pour organiser leurs campagnes"
    columns:
      - name: id
        description: "Identifiant unique du groupe"
        tests:
          - unique
          - not_null
      - name: title
        description: "Titre du groupe"
        tests:
          - not_null
      - name: description
        description: "Description du groupe"
      - name: created_at
        description: "Date de cr√©ation du groupe"
        tests:
          - not_null
      - name: archived_at
        description: "Date d'archivage du groupe"
      - name: user_id
        description: "Identifiant de l'utilisateur cr√©ateur du groupe"
      - name: establishment_id
        description: "Identifiant de l'√©tablissement propri√©taire du groupe"
        tests:
          - not_null
          - relationships:
              to: ref('marts_production_establishments')
              field: id
      - name: exported_at
        description: "Date d'export du groupe"

  - name: marts_production_owners
    description: "Table des propri√©taires de logements avec informations personnelles et adresses"
    columns:
      - name: owner_id
        description: "Identifiant unique du propri√©taire (UUID converti en VARCHAR)"
        tests:
          - unique
          - not_null
      - name: id
        description: "Identifiant UUID original du propri√©taire"
        tests:
          - unique
          - not_null
      - name: full_name
        description: "Nom complet du propri√©taire"
      - name: birth_date
        description: "Date de naissance du propri√©taire"
      - name: administrator
        description: "Administrateur du propri√©taire (pour les personnes morales)"
      - name: address_dgfip
        description: "Adresse du propri√©taire selon la DGFiP (format array)"
      - name: kind_class
        description: "Classe de type de propri√©taire"
      - name: owner_kind_detail
        description: "D√©tail du type de propri√©taire"
      - name: email
        description: "Adresse email du propri√©taire"
      - name: phone
        description: "Num√©ro de t√©l√©phone du propri√©taire"
      - name: additional_address
        description: "Adresse compl√©mentaire"
      - name: idpersonne
        description: "Identifiant personne"
      - name: siren
        description: "Num√©ro SIREN (pour les personnes morales)"
      - name: data_source
        description: "Source des donn√©es du propri√©taire"
      - name: created_at
        description: "Date de cr√©ation de l'enregistrement"
      - name: updated_at
        description: "Date de derni√®re mise √† jour"
      - name: entity
        description: "Entit√© du propri√©taire"
      - name: full_name_fts
        description: "Nom complet pour la recherche textuelle"
      - name: address_element
        description: "√âl√©ment d'adresse"
      - name: cleaned_address
        description: "Adresse nettoy√©e"
      - name: postal_code
        description: "Code postal"
      - name: city
        description: "Ville"
      - name: street_address
        description: "Adresse de rue"

  - name: marts_production_users
    description: "Table des utilisateurs avec informations sur leurs √©tablissements de rattachement"
    columns:
      - name: user_id
        description: "Identifiant unique de l'utilisateur (UUID converti en VARCHAR)"
      - name: establishment_id
        description: "Identifiant de l'√©tablissement de rattachement (UUID converti en VARCHAR)"
        tests:
          - relationships:
              to: ref('marts_production_establishments')
              field: establishment_id
      - name: id
        description: "Identifiant UUID original de l'utilisateur"
        tests:
          - unique
          - not_null
      - name: email
        description: "Adresse email de l'utilisateur"
        tests:
          - unique
          - not_null
      - name: password
        description: "Mot de passe hash√© de l'utilisateur"
      - name: first_name
        description: "Pr√©nom de l'utilisateur"
      - name: last_name
        description: "Nom de famille de l'utilisateur"
      - name: role
        description: "R√¥le de l'utilisateur (num√©rique)"
      - name: activated_at
        description: "Date d'activation du compte utilisateur"
      - name: last_authenticated_at
        description: "Date de derni√®re authentification"
      - name: deleted_at
        description: "Date de suppression du compte"
      - name: updated_at
        description: "Date de derni√®re mise √† jour"
      - name: phone
        description: "Num√©ro de t√©l√©phone de l'utilisateur"
      - name: position
        description: "Poste/fonction de l'utilisateur"
      - name: time_per_week
        description: "Temps consacr√© par semaine"
      - name: suspended_at
        description: "Date de suspension du compte"
      - name: suspended_cause
        description: "Cause de la suspension"
      - name: user_type
        description: "Type d'utilisateur"
      - name: siren
        description: "Num√©ro SIREN de l'√©tablissement"
      - name: name
        description: "Nom de l'√©tablissement"
      - name: available
        description: "Disponibilit√© de l'√©tablissement"
      - name: localities_geo_code
        description: "Codes g√©ographiques des communes couvertes par l'√©tablissement"
      - name: kind
        description: "Type d'√©tablissement"
      - name: source
        description: "Source des donn√©es de l'√©tablissement"
      - name: establishment_kind_label
        description: "Libell√© du type d'√©tablissement"
      - name: establishment_synthetic_type_label
        description: "Libell√© synth√©tique du type d'√©tablissement"
      - name: covered_by_state_service
        description: "Indicateur si l'√©tablissement est couvert par un service de l'√âtat"